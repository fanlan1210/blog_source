<!DOCTYPE html>
<html lang="zh-TW">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  
  
  
  
  <link rel="prev" href="http://blog.steveyi.net/2020/cloudready/" />
  <link rel="next" href="http://blog.steveyi.net/2020/macos-recovery/" />
  <link rel="canonical" href="http://blog.steveyi.net/2020/bgp-network-peer/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           透過BGP組建不同網段互通 | 酷小易
       
  </title>
  <meta name="title" content="透過BGP組建不同網段互通 | 酷小易">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "http:\/\/blog.steveyi.net\/"
    },
    "articleSection" : "posts",
    "name" : "透過BGP組建不同網段互通",
    "headline" : "透過BGP組建不同網段互通",
    "description" : "小時候常常為了家中的網路管理而困擾，舉例來說，我家有三個樓層 三個路由器\n我想讓三個路由器後的設備可以互通，但是如果我三台路由器都打開DHCP Server的話，三台將會是獨立的網段而不互通\n後來發現如果使用bridge(橋接)的方式將一台路由器當作DHCP Server，其他的當作AP或Switch，就可以達到網段相同且可以互通了！\n不過，這次我們要做的是\u0026quot;異地組網\u0026quot;，很難去做到使用同一個的DHCP Server來連接，所以就會有兩個網段\n那之前有跟大家分享過 FRRouting 入坑指南兼心得(1)，我們也可以透過BGP及隧道來組建不同區域網段互通\n讓我們開始吧！\n首先，我們需要先準備一些東西\n路由器須為Linux系統(如果是ROS或Cisco IOS也可以)\n路由套件(推薦使用Frrouting, bird)\n本篇將以Frrouting作為示範\n首先，雙方路由器必須支持BGP，否則只能使用NAT設備來進行互通了\n我們先在雙方路由器配置好路由器IP\n以下為範例\nRouter-A 的IPv4為 10.0.1.1\/24 DHCP 分配 10.0.1.2 - 10.0.1.254\nRouter-B 的IPv4為 10.0.2.1\/24 DHCP 分配 10.0.2.2 - 10.0.2.254\n那我們在路由器A向B廣播 network 10.0.1.0\/24\n相對應的，路由器B向A廣播 network 10.0.2.0\/24\n接著確認雙方BGP Session通了之後，我們檢查系統路由表ip route\n應該就會看到下方這樣\n10.0.1.0\/24 via 對方的隧道IP dev tun0 proto bgp metric 20 \n接著就可以嘗試使用mtr或ping看對方路由器後的網段設備是否有連通囉！\n給大家參考一下frrouting的配置文件\n路由器A\nCurrent configuration: ! frr version 7.3.1 frr defaults traditional hostname gateway-tw log syslog informational service integrated-vtysh-config !",
    "inLanguage" : "zh-TW",
    "author" : "",
    "creator" : "",
    "publisher": "",
    "accountablePerson" : "",
    "copyrightHolder" : "",
    "copyrightYear" : "2020",
    "datePublished": "2020-08-11 18:56:26 \u002b0000 \u002b0000",
    "dateModified" : "2020-08-11 18:56:26 \u002b0000 \u002b0000",
    "url" : "http:\/\/blog.steveyi.net\/2020\/bgp-network-peer\/",
    "wordCount" : "152",
    "keywords" : [ "BGP", "酷小易"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="http://blog.steveyi.net/">酷小易</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">文章</a>
                
                <a class="menu-item" href="https://steveyi.net/" title="">關於我</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="http://blog.steveyi.net/">酷小易</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">文章</a>
                
                <a class="menu-item" href="https://steveyi.net/" title="">關於我</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">透過BGP組建不同網段互通</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="http://blog.steveyi.net/" rel="author"></a> with ♥ 
                <span class="post-time">
                on <time datetime=2020-08-11 itemprop="datePublished">August 11, 2020</time>
                </span>
                in
                
        </div>
    </header>
    <div class="post-content">
        

        
            
        

        
        
     
          
          
          

          
          
          

          <p>小時候常常為了家中的網路管理而困擾，舉例來說，我家有三個樓層 三個路由器<br>
我想讓三個路由器後的設備可以互通，但是如果我三台路由器都打開DHCP Server的話，三台將會是獨立的網段而不互通</p>
<p>後來發現如果使用bridge(橋接)的方式將一台路由器當作DHCP Server，其他的當作AP或Switch，就可以達到網段相同且可以互通了！</p>
<p>不過，這次我們要做的是&quot;異地組網&quot;，很難去做到使用同一個的DHCP Server來連接，所以就會有兩個網段</p>
<p>那之前有跟大家分享過 <a href="https://blog.steveyi.net/frrouting-install/">FRRouting 入坑指南兼心得(1)</a>，我們也可以透過BGP及隧道來組建不同區域網段互通</p>
<p>讓我們開始吧！</p>
<p>首先，我們需要先準備一些東西</p>
<p>路由器須為Linux系統(如果是ROS或Cisco IOS也可以)<br>
路由套件(推薦使用Frrouting, bird)</p>
<p>本篇將以<a href="https://frrouting.org/">Frrouting</a>作為示範</p>
<p>首先，雙方路由器必須支持BGP，否則只能使用NAT設備來進行互通了</p>
<p>我們先在雙方路由器配置好路由器IP<br>
以下為範例<br>
Router-A 的IPv4為 10.0.1.1/24 DHCP 分配 10.0.1.2 - 10.0.1.254<br>
Router-B 的IPv4為 10.0.2.1/24 DHCP 分配 10.0.2.2 - 10.0.2.254</p>
<p>那我們在路由器A向B廣播 network 10.0.1.0/24<br>
相對應的，路由器B向A廣播 network 10.0.2.0/24</p>
<p>接著確認雙方BGP Session通了之後，我們檢查系統路由表<code>ip route</code><br>
應該就會看到下方這樣<br>
<code>10.0.1.0/24 via 對方的隧道IP dev tun0 proto bgp metric 20 </code></p>
<p>接著就可以嘗試使用mtr或ping看對方路由器後的網段設備是否有連通囉！</p>
<p>給大家參考一下frrouting的配置文件</p>
<p>路由器A</p>
<pre><code>Current configuration:
!
frr version 7.3.1
frr defaults traditional
hostname gateway-tw
log syslog informational
service integrated-vtysh-config
!
router bgp 209557
 neighbor 10.121.1.22 remote-as 209557
 neighbor 10.121.1.22 description JP-Gateway
 !
 address-family ipv4 unicast
  network 10.0.1.0/24
 exit-address-family
!
line vty
!
end
</code></pre><p>路由器B</p>
<pre><code>Current configuration:
!
frr version 7.3.1
frr defaults traditional
hostname gateway-tw
log syslog informational
service integrated-vtysh-config
!
router bgp 209557
 neighbor 10.121.1.21 remote-as 209557
 neighbor 10.121.1.21 description TW-Gateway
 !
 address-family ipv4 unicast
  network 10.0.2.0/24
 exit-address-family
!
line vty
!
end
</code></pre><p><img src="https://static.yiy.tw/media/blog/2020081118552052.png" alt=""></p>
<p>完成後，效果會類似這樣唷！</p>
<p>PS. 其實更簡單的方式是直接在A, B路由器上寫上路由表<br>
<code>ip route add 10.0.1.0/24 via peer_tunnel_ip dev tunnel_interfaces</code></p>

    </div>

    <div class="post-copyright">
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=http://blog.steveyi.net/2020/bgp-network-peer/>http://blog.steveyi.net/2020/bgp-network-peer/</span>
            </p>
            
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="http://blog.steveyi.net/tags/bgp/">
                    #BGP</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="http://blog.steveyi.net/">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="http://blog.steveyi.net/2020/cloudready/" class="prev" rel="prev" title="使用CloudReady體驗ChromiumOS作業系統，老電腦重獲新生!"><i class="iconfont icon-left"></i>&nbsp;使用CloudReady體驗ChromiumOS作業系統，老電腦重獲新生!</a>
         
        
        <a href="http://blog.steveyi.net/2020/macos-recovery/" class="next" rel="next" title="macOS重灌不求人！使用內建回復功能輕鬆重灌Mac電腦">macOS重灌不求人！使用內建回復功能輕鬆重灌Mac電腦&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
     <link href="//lib.baomitu.com/lightgallery/1.6.11/css/lightgallery.min.css" rel="stylesheet">  
      
     <script src="/js/vendor_gallery.min.js" async="" ></script>
    
  



     </div>
  </body>
</html>
