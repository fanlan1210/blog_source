<!DOCTYPE html>
<html lang="zh-TW">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  
  
  
  
  <link rel="prev" href="http://blog.steveyi.net/2020/ntp-clock-autoset/" />
  <link rel="next" href="http://blog.steveyi.net/2020/create-object-in-ripe-database/" />
  <link rel="canonical" href="http://blog.steveyi.net/2020/usingwireguard-to-make-intranet/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           利用WireGuard建立大內網 | 酷小易
       
  </title>
  <meta name="title" content="利用WireGuard建立大內網 | 酷小易">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "http:\/\/blog.steveyi.net\/"
    },
    "articleSection" : "posts",
    "name" : "利用WireGuard建立大內網",
    "headline" : "利用WireGuard建立大內網",
    "description" : "Hi 大家好，今天來分享一下如何使用WireGuard建立大內網\n之前有與大家分享過 在Linux系統上安裝Wireguard，那這次我們要利用WireGuard來建立大內網\n為什麼筆者稱這次要建立\u0026quot;大內網\u0026quot;呢？\n因為筆者也許多不同地方的網路，想藉由這次機會，來把他們都加進同一個局域網\n這樣也可以解決一些連線問題，比如筆者常常連線回到家中的電腦\n但因為公網IP只有幾個，當機器太多時，就需要設定內網穿透\n但筆者架設了內網之後，在外面只需要連入VPN，在其他網路區域，就可以存取所有網路設備了（這也類似於一般企業的遠端存取）\n那麼，我們一樣需要有一個主伺服器當網關。不過，我們不使用NAT TO NAT，而是透過私網IP來進行互連\n我們的情境是這樣：\nA辦公室 路由器 10.121.208.254\/24\nB辦公室 路由器 10.121.209.254\/24\nC辦公室 路由器 10.121.210.254\/24\nVPN路由器 10.121.211.254\/24\n首先，由於我們這次是純粹架設大內網，以WireGuard搭配靜態路由為主。所以先不講到路由協議（不過下次會介紹）\n我們需要有一個主路由器，並透過它來連接A,B,C辦公室的路由器\n所以會變成下面這樣\nVPN \u0026lt;-\u0026gt; A\nVPN \u0026lt;-\u0026gt; B\nVPN \u0026lt;-\u0026gt; C\n當A的用戶想去C時(10.121.208.1 \u0026lt;-\u0026gt; 10.121.210.2) 路線會變成\u0026hellip;\nUser-A -\u0026gt; 10.121.208.254 -\u0026gt; 10.121.211.254 -\u0026gt; 10.121.210.254 -\u0026gt; 10.121.210.2(User-C)\n也就是 User-A -\u0026gt; A的路由器 -\u0026gt; VPN Gateway -\u0026gt; C的路由器 -\u0026gt; User-C\n那我們搞懂原理，就來實作啦！\n首先，我先先準備好私鑰及公鑰（公鑰是由私鑰算過來的）\nA\u0026rsquo;s Public key: WGokwN2HtiX\u002bnaa7hdvUaXoXk5tkzXQtMge4v9DKlVw=\nB\u0026rsquo;s Public key: fVNXw6EpC65DmIsY\/XsWXL6EXLU9oFW7CL5cZr82Di8=",
    "inLanguage" : "zh-TW",
    "author" : "",
    "creator" : "",
    "publisher": "",
    "accountablePerson" : "",
    "copyrightHolder" : "",
    "copyrightYear" : "2020",
    "datePublished": "2020-11-20 18:31:04 \u002b0000 \u002b0000",
    "dateModified" : "2020-11-20 18:31:04 \u002b0000 \u002b0000",
    "url" : "http:\/\/blog.steveyi.net\/2020\/usingwireguard-to-make-intranet\/",
    "wordCount" : "147",
    "keywords" : [ "VPS","伺服器", "酷小易"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="http://blog.steveyi.net/">酷小易</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">文章</a>
                
                <a class="menu-item" href="https://steveyi.net/" title="">關於我</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="http://blog.steveyi.net/">酷小易</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">文章</a>
                
                <a class="menu-item" href="https://steveyi.net/" title="">關於我</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">利用WireGuard建立大內網</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="http://blog.steveyi.net/" rel="author"></a> with ♥ 
                <span class="post-time">
                on <time datetime=2020-11-20 itemprop="datePublished">November 20, 2020</time>
                </span>
                in
                
        </div>
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          <p>Hi 大家好，今天來分享一下如何使用WireGuard建立大內網</p>
<p>之前有與大家分享過 <a href="https://blog.steveyi.net/how-to-install-wireguard/" title="在Linux系統上安裝Wireguard">在Linux系統上安裝Wireguard</a>，那這次我們要利用WireGuard來建立大內網</p>
<p>為什麼筆者稱這次要建立&quot;大內網&quot;呢？<br>
因為筆者也許多不同地方的網路，想藉由這次機會，來把他們都加進同一個局域網</p>
<p>這樣也可以解決一些連線問題，比如筆者常常連線回到家中的電腦<br>
但因為公網IP只有幾個，當機器太多時，就需要設定內網穿透</p>
<p>但筆者架設了內網之後，在外面只需要連入VPN，在其他網路區域，就可以存取所有網路設備了（這也類似於一般企業的遠端存取）</p>
<p>那麼，我們一樣需要有一個主伺服器當網關。不過，我們不使用NAT TO NAT，而是透過私網IP來進行互連</p>
<p>我們的情境是這樣：</p>
<p>A辦公室 路由器 10.121.208.254/24<br>
B辦公室 路由器 10.121.209.254/24<br>
C辦公室 路由器 10.121.210.254/24<br>
VPN路由器 10.121.211.254/24</p>
<p>首先，由於我們這次是純粹架設大內網，以WireGuard搭配靜態路由為主。所以先不講到路由協議（不過下次會介紹）</p>
<p>我們需要有一個主路由器，並透過它來連接A,B,C辦公室的路由器</p>
<p>所以會變成下面這樣<br>
VPN &lt;-&gt; A<br>
VPN &lt;-&gt; B<br>
VPN &lt;-&gt; C</p>
<p>當A的用戶想去C時(10.121.208.1 &lt;-&gt; 10.121.210.2) 路線會變成&hellip;</p>
<p>User-A -&gt; 10.121.208.254 -&gt; 10.121.211.254 -&gt; 10.121.210.254 -&gt; 10.121.210.2(User-C)</p>
<p>也就是 User-A -&gt; A的路由器 -&gt; VPN Gateway -&gt; C的路由器 -&gt; User-C</p>
<p>那我們搞懂原理，就來實作啦！</p>
<p>首先，我先先準備好私鑰及公鑰（公鑰是由私鑰算過來的）</p>
<p>A&rsquo;s Public key: WGokwN2HtiX+naa7hdvUaXoXk5tkzXQtMge4v9DKlVw=<br>
B&rsquo;s Public key: fVNXw6EpC65DmIsY/XsWXL6EXLU9oFW7CL5cZr82Di8=<br>
C&rsquo;s Public key: ORbEFZlR/IWFWaD42Nh00DfYEpCX2CbNmRy/Hc+crVQ=<br>
VPN&rsquo;s Public Key: Rxcti9/3jLII4JOscHn9/yp5Z8ZROcYk8tugXn/FRHM=</p>
<p>那我們就在配置中這樣寫&hellip;</p>
<pre><code>[Interface]
PrivateKey = &lt;各處的private key&gt;
Address = &lt;各個路由器的IP，比如說A路由器 10.121.208.254/24&gt;

# Server
[Peer]
PublicKey = &lt;VPN Gateway Public Key&gt;
Endpoint = &lt;VPN Gateway's EndPoint&gt;
AllowedIPs = 10.121.209.0/24,10.121.210.0/24,10.121.211.0/24
PersistentKeepalive = 10
</code></pre><p>我們在個節點這樣配，上方例子是A路由器的<br>
B路由器則是這樣</p>
<pre><code>[Interface]
PrivateKey = &lt;各處的private key&gt;
Address = &lt;各個路由器的IP，比如說B路由器 10.121.209.254/24&gt;

# Server
[Peer]
PublicKey = &lt;VPN Gateway Public Key&gt;
Endpoint = &lt;VPN Gateway's EndPoint&gt;
AllowedIPs = 10.121.208.0/24,10.121.210.0/24,10.121.211.0/24
PersistentKeepalive = 10
</code></pre><p>相Ｎ信C路由器大家應該就會配了</p>
<p>最後，大家只需要在每台路由器上執行指令 <code>wg-quick up &lt;wireguard_網卡名稱&gt;</code> 就可以互通啦！</p>
<p>特別注意：這種網路架構，如果VPN Gateway掉線了，那A,B,C也就不能彼此互通了</p>

    </div>

    <div class="post-copyright">
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=http://blog.steveyi.net/2020/usingwireguard-to-make-intranet/>http://blog.steveyi.net/2020/usingwireguard-to-make-intranet/</span>
            </p>
            
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="http://blog.steveyi.net/tags/vps/">
                    #VPS</a></span>
            
            <span class="tag"><a href="http://blog.steveyi.net/tags/%E4%BC%BA%E6%9C%8D%E5%99%A8/">
                    #伺服器</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="http://blog.steveyi.net/">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="http://blog.steveyi.net/2020/ntp-clock-autoset/" class="prev" rel="prev" title="Windows 10打開電腦(喚醒)後自動校正時間"><i class="iconfont icon-left"></i>&nbsp;Windows 10打開電腦(喚醒)後自動校正時間</a>
         
        
        <a href="http://blog.steveyi.net/2020/create-object-in-ripe-database/" class="next" rel="next" title="在RIPE DataBase建立Object">在RIPE DataBase建立Object&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  



     </div>
  </body>
</html>
